<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Particle Heart</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: black;
      color: white;
      font-family: Arial, sans-serif;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(0, 0, 0, 0.5);
      padding: 15px;
      border-radius: 8px;
    }
    .slider {
      margin: 10px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input[type="range"] {
      width: 100%;
    }
    input[type="color"] {
      width: 50%;
    }
    #footer {
      position: absolute;
      bottom: 10px;
      right: 10px;
      z-index: 10;
      display: flex;
      flex-direction: row;
      gap: 10px;
      flex-wrap: wrap;
    }
    #footer a, #footer button {
      color: white;
      font-size: 16px;
      text-decoration: none;
      border: 1px solid white;
      padding: 5px 10px;
      border-radius: 5px;
      transition: background-color 0.3s ease;
      background: none;
      cursor: pointer;
    }
    #footer a:hover, #footer button:hover {
      background-color: white;
      color: black;
    }
    @media (max-width: 768px) {
      #controls {
        position: fixed;
        top: auto;
        bottom: 70px;
        left: 50%;
        transform: translateX(-50%);
        width: 85%;
        max-width: 280px;
        padding: 8px;
        background: rgba(0, 0, 0, 0.7);
      }
      .slider {
        margin: 3px 0;
      }
      label {
        font-size: 11px;
        margin-bottom: 2px;
      }
      input[type="range"] {
        height: 15px;
        -webkit-appearance: none;
        appearance: none;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 7px;
        margin: 3px 0;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 15px;
        height: 15px;
        background: white;
        border-radius: 50%;
      }
      input[type="color"] {
        width: 40%;
        height: 20px;
      }
      #footer {
        position: fixed;
        bottom: 15px;
        right: 50%;
        transform: translateX(50%);
        display: flex;
        flex-direction: row;
        justify-content: center;
        gap: 8px;
        background: rgba(0, 0, 0, 0.7);
        padding: 8px;
        border-radius: 5px;
        width: 85%;
        max-width: 280px;
      }
      #footer a, #footer button {
        font-size: 11px;
        padding: 4px 8px;
        flex: 1;
        text-align: center;
        min-width: 0;
      }
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div id="controls">
    <div class="slider">
      <label for="particleCount">Particles</label>
      <input id="particleCount" type="range" min="1" max="20" value="5">
    </div>
    <div class="slider">
      <label for="heartSize">Heart Size</label>
      <input id="heartSize" type="range" min="5" max="30" value="15">
    </div>
    <div class="slider">
      <label for="velocity">Velocity</label>
      <input id="velocity" type="range" min="0.1" max="5" step="0.1" value="1">
    </div>
    <div class="slider">
      <label for="color1">Color 1</label>
      <input id="color1" type="color" value="#FF3232">
    </div>
    <div class="slider">
      <label for="color2">Color 2</label>
      <input id="color2" type="color" value="#3232FF">
    </div>
  </div>

  <div id="footer">
    <button id="exportBtn">Download Heart</button>
    <a href="https://enzepei.github.io/" target="_blank" rel="noopener noreferrer">Created by Enzo</a>
    <!-- <a href="https://www.paypal.com/donate?hosted_button_id=YOUR_BUTTON_ID" target="_blank" rel="noopener noreferrer">Tip Me ❤️</a> -->
    <a href="log.html" target="_blank" rel="noopener noreferrer">View Logs</a>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      const dpr = window.devicePixelRatio || 1;
      canvas.width = window.innerWidth * dpr;
      canvas.height = window.innerHeight * dpr;
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      ctx.scale(dpr, dpr);
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    const particleCountSlider = document.getElementById('particleCount');
    const heartSizeSlider = document.getElementById('heartSize');
    const velocitySlider = document.getElementById('velocity');
    const color1Picker = document.getElementById('color1');
    const color2Picker = document.getElementById('color2');
    const exportBtn = document.getElementById('exportBtn');

    const particles = [];

    function setHeartSizeRange() {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        heartSizeSlider.value = 8;
        heartSizeSlider.min = 3;
        heartSizeSlider.max = 15;
      } else {
        heartSizeSlider.value = 15;
        heartSizeSlider.min = 5;
        heartSizeSlider.max = 30;
      }
    }
    setHeartSizeRange();
    window.addEventListener('resize', setHeartSizeRange);

    class Particle {
      constructor(x, y, size, color1, color2, velocity, lifetime) {
        this.x = x;
        this.y = y;
        this.size = size;
        this.color1 = color1;
        this.color2 = color2;
        this.velocity = velocity;
        this.lifetime = lifetime;
        this.age = 0;
      }

      move() {
        this.x += this.velocity.x;
        this.y += this.velocity.y;
        this.size = Math.max(this.size - 0.1, 0);
        this.age++;
      }

      blendColor() {
        const ratio = Math.min(this.age / this.lifetime, 1);
        const r = Math.floor(this.color1.r * (1 - ratio) + this.color2.r * ratio);
        const g = Math.floor(this.color1.g * (1 - ratio) + this.color2.g * ratio);
        const b = Math.floor(this.color1.b * (1 - ratio) + this.color2.b * ratio);
        return `rgb(${r}, ${g}, ${b})`;
      }

      draw(context) {
        if (this.size > 0) {
          context.beginPath();
          context.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          context.fillStyle = this.blendColor();
          context.fill();
        }
      }
    }

    function parseColor(hex) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return { r, g, b };
    }

    function heartShape(t, scale) {
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
      return { x: x * scale, y: -y * scale };
    }

    function addParticles() {
      const particleCount = parseInt(particleCountSlider.value);
      const heartSize = parseInt(heartSizeSlider.value);
      const velocityScale = parseFloat(velocitySlider.value);
      const color1 = parseColor(color1Picker.value);
      const color2 = parseColor(color2Picker.value);

      for (let i = 0; i < particleCount; i++) {
        const t = Math.random() * Math.PI * 2;
        const { x: hx, y: hy } = heartShape(t, heartSize);
        const x = window.innerWidth / 2 + hx;
        const y = window.innerHeight / 2 + hy;
        const size = Math.random() * 3 + 3;
        const velocity = {
          x: (Math.random() - 0.5) * velocityScale,
          y: (Math.random() - 0.5) * velocityScale,
        };
        const lifetime = Math.random() * 60 + 40;

        particles.push(new Particle(x, y, size, color1, color2, velocity, lifetime));
      }
    }

    function animate() {
      const dpr = window.devicePixelRatio || 1;
      ctx.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);
      ctx.fillStyle = 'black';
      ctx.fillRect(0, 0, canvas.width / dpr, canvas.height / dpr);
      addParticles();

      for (let i = particles.length - 1; i >= 0; i--) {
        const particle = particles[i];
        particle.move();
        particle.draw(ctx);
        if (particle.size <= 0) {
          particles.splice(i, 1);
        }
      }
      requestAnimationFrame(animate);
    }

    exportBtn.addEventListener('click', () => {
      // Create a temporary canvas with current size
      const tempCanvas = document.createElement('canvas');
      const tempCtx = tempCanvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      
      tempCanvas.width = canvas.width;
      tempCanvas.height = canvas.height;
      
      // Draw black background
      tempCtx.fillStyle = 'black';
      tempCtx.fillRect(0, 0, tempCanvas.width / dpr, tempCanvas.height / dpr);
      
      // Draw the current canvas content
      tempCtx.drawImage(canvas, 0, 0);
      
      // Convert to data URL and trigger download
      try {
        const dataUrl = tempCanvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = 'heart.png';
        link.href = dataUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch (error) {
        console.error('Error exporting image:', error);
      }
    });

    animate();
  </script>
</body>
</html>
